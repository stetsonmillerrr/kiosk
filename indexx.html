<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lock Screen</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
<style>
  input::-webkit-inner-spin-button,
  input::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }

  .floating-label input:focus + label,
  .floating-label input:not(:placeholder-shown) + label {
    transform: translateY(-1.75rem);
    font-size: 0.75rem;
    opacity: 0.8;
  }
  .floating-label label {
    position: absolute; left: 1rem; top: 50%;
    transform: translateY(-50%); color: white; pointer-events: none;
    transition: all 0.3s ease; font-size: 1rem; opacity: 0.7;
  }

  #pinInput { letter-spacing: 0.5rem; font-size: 1.5rem; transition: letter-spacing 0.3s ease, transform 0.2s ease; }
  #pinInput.filled { letter-spacing: 1.5rem; transform: scale(1.05); }

  .spinner {
    border: 4px solid rgba(255,255,255,0.2);
    border-top: 4px solid white;
    border-radius: 50%; width: 2.5rem; height: 2.5rem;
    animation: spin 1s linear infinite; margin-top: 1rem;
    opacity: 0; transition: opacity 0.5s ease;
  }
  @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

  #trialInfo { color: white; margin-top: 0.5rem; font-size: 0.9rem; text-align:center; opacity:0; transition: opacity 0.5s ease; }

  .fade-out { opacity:0; transition: opacity 0.5s ease; }
  .fade-in { opacity:1 !important; }
  #pinSubmit { transition: opacity 0.5s ease; }

  /* Blur overlay */
  #blurOverlay { position:absolute; inset:0; background:rgba(0,0,0,0.35); backdrop-filter:blur(5px); opacity:0; transition:opacity 0.5s ease; z-index:50; pointer-events:none; }
  #blurOverlay.active { opacity:1; pointer-events:all; }

  /* Battery box */
  #batteryBox {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 38px;
    height: 18px;
    border: 2px solid white;
    border-radius: 3px;
    display: flex;
    align-items: center;
    padding: 1px;
    background: transparent;
    cursor: default;
    overflow: hidden;
  }
  #batteryFill,
  #batteryCap,
  #batteryBolt,
  #batteryPercent {
    pointer-events: none; /* ensures tooltip works */
    transition: background 0.3s ease;
  }
  #batteryFill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(to right, #22c55e, #16a34a, #15803d);
    transition: width 0.4s ease, background 0.3s ease;
  }
  #batteryBox:hover #batteryFill {
    background: black;
  }
  #batteryCap {
    position: absolute;
    top: 4px;
    right: -6px;
    width: 4px;
    height: 10px;
    border-radius: 1px;
    background: white;
  }
  #batteryBolt {
    position: absolute;
    top: 1px;
    left: 2px;
    font-size: 12px;
    color: white;
    text-shadow: -1px -1px 0 black, 1px -1px 0 black,
                 -1px 1px 0 black, 1px 1px 0 black;
    display: none;
  }
  #batteryPercent {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
    color: white;
    opacity: 0;
    transition: opacity 0.3s ease;
    text-shadow: -1px -1px 0 black, 1px -1px 0 black,
                 -1px 1px 0 black, 1px 1px 0 black;
  }
  #batteryBox:hover #batteryPercent {
    opacity: 1;
  }
</style>
</head>
<body>
<div class="relative min-h-screen w-full bg-cover bg-center flex items-center justify-center">
  <img alt="Background" class="absolute inset-0 w-full h-full object-cover -z-10"
       src="https://storage.googleapis.com/a1aa/image/5acb54eb-b2bf-4052-081b-3c10c921b4eb.jpg"/>
  
  <div id="blurOverlay"></div>

  <!-- Battery -->
  <div id="batteryBox" title="Battery: --%">
    <div id="batteryFill"></div>
    <div id="batteryCap"></div>
    <i id="batteryBolt" class="fas fa-bolt"></i>
    <div id="batteryPercent">--%</div>
  </div>

  <div class="flex flex-col items-center space-y-4 -translate-y-10">
    <div class="rounded-full bg-[#8a92b0] w-36 h-36 flex items-center justify-center shadow-lg">
      <i class="fas fa-user-circle text-gray-700 text-[7.5rem]"></i>
    </div>
    <h1 id="usernameDisplay" class="text-white text-[1.5rem] font-semibold font-sans select-none"
        style="text-shadow:0 0 3px rgba(0,0,0,0.7)">System</h1>

    <div id="pinContainer">
      <form id="pinForm" class="relative w-72">
        <div class="relative floating-label w-full">
          <input id="pinInput" type="password" inputmode="numeric" pattern="\d*" maxlength="4"
                 autocomplete="off" placeholder=" "
                 class="w-full bg-white/20 backdrop-blur-md border border-gray-300 rounded-md py-3 px-4
                        text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500
                        transition duration-200 shadow-md" spellcheck="false"/>
          <label for="pinInput">Pin</label>
          <button id="pinSubmit" aria-label="Submit PIN"
                  class="absolute right-2 top-1/2 -translate-y-1/2 text-white text-xl opacity-0
                         transition-opacity duration-500" type="submit">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </form>
      <p id="pinError" class="text-red-400 text-sm mt-2 hidden">
        The PIN is incorrect. Please wait 15 seconds.
      </p>
    </div>
  </div>

  <div class="absolute bottom-8 left-8 flex flex-col space-y-3">
    <button id="userMain"
            class="flex items-center space-x-3 bg-white/20 backdrop-blur-sm rounded-md px-3 py-2
                   hover:bg-white/30 transition-colors duration-200">
      <div class="rounded-full bg-[#8a92b0] w-10 h-10 flex items-center justify-center flex-shrink-0">
        <i class="fas fa-user-circle text-gray-700 text-2xl"></i>
      </div>
      <span class="text-white text-sm font-sans truncate max-w-[7.5rem] select-none">System</span>
    </button>

    <button id="guestBtn"
            class="flex items-center space-x-3 bg-white/20 backdrop-blur-sm rounded-md px-3 py-2
                   hover:bg-white/30 transition-colors duration-200">
      <div class="rounded-full bg-[#8a92b0] w-10 h-10 flex items-center justify-center flex-shrink-0">
        <i class="fas fa-user-circle text-gray-700 text-2xl"></i>
      </div>
      <span id="guestText" class="text-white text-sm font-sans select-none">Guest - Free</span>
    </button>
  </div>

  <div class="absolute bottom-8 right-8 flex items-center space-x-8 text-white text-xl opacity-90">
    <button aria-label="Network" class="hover:text-blue-500 transition-colors duration-200">
      <i class="fas fa-desktop"></i>
    </button>
    <button aria-label="Accessibility" class="hover:text-blue-500 transition-colors duration-200">
      <i class="fas fa-universal-access"></i>
    </button>
    <button aria-label="Power" class="hover:text-blue-500 transition-colors duration-200">
      <i class="fas fa-power-off"></i>
    </button>
  </div>
</div>

<script>
const pinInput = document.getElementById('pinInput');
const pinSubmit = document.getElementById('pinSubmit');
const pinForm = document.getElementById('pinForm');
const pinError = document.getElementById('pinError');
const pinContainer = document.getElementById('pinContainer');
const usernameDisplay = document.getElementById('usernameDisplay');
const guestBtn = document.getElementById('guestBtn');
const guestText = document.getElementById('guestText');
const blurOverlay = document.getElementById('blurOverlay');

const correctPINMain = '0424';
let locked = false;

// Guest trial
let guestUsed = localStorage.getItem('guestUsed') === 'true';
if(guestUsed){
  guestBtn.disabled=true;
  guestBtn.classList.add('opacity-50','cursor-not-allowed');
  guestText.textContent='Guest - Expired';
}
const lastUser = localStorage.getItem('lastUser');
if(lastUser==='guest') usernameDisplay.textContent='Guest';

function showBlur(){ blurOverlay.classList.add('active'); }
function hideBlur(){ blurOverlay.classList.remove('active'); }

// Smart auto-login
const savedPINSuccess = localStorage.getItem('PINSuccess') === 'true';
window.addEventListener('DOMContentLoaded', ()=>{
  if(savedPINSuccess){
    pinInput.value = correctPINMain;
    pinInput.classList.add('filled');
    pinSubmit.classList.add('fade-in');
    pinContainer.innerHTML='<div class="spinner fade-in"></div>';
    setTimeout(()=>{
      showBlur();
      setTimeout(()=>{ window.location.href='kiosk.html'; }, 2000);
    },10000); // wait 10s before blur
  }
});

// Guest button
guestBtn.addEventListener('click', ()=>{
  if(guestUsed) return;
  localStorage.setItem('guestUsed','true');
  localStorage.setItem('lastUser','guest');
  guestUsed=true;
  usernameDisplay.classList.add('fade-out');
  setTimeout(()=>{
    usernameDisplay.textContent='Guest';
    usernameDisplay.classList.remove('fade-out');
    usernameDisplay.classList.add('fade-in');
  },500);
  guestBtn.disabled=true;
  guestBtn.classList.add('opacity-50','cursor-not-allowed');
  guestText.textContent='Guest - Expired';
  pinContainer.innerHTML='<div class="spinner"></div><div id="trialInfo">Trials left: 0/1</div>';
  const spinner=pinContainer.querySelector('.spinner');
  const trialInfo=document.getElementById('trialInfo');
  setTimeout(()=>{spinner.classList.add('fade-in'); trialInfo.classList.add('fade-in');},50);
  setTimeout(()=>{window.location.href='kiosk.html';},4000);
});

// Arrow fade and PIN dots animate
pinInput.addEventListener('input', ()=>{
  pinInput.value=pinInput.value.replace(/\D/g,'');
  if(pinInput.value.length>0) pinInput.classList.add('filled');
  else pinInput.classList.remove('filled');
  if(pinInput.value.length===4 && !locked) pinSubmit.classList.add('fade-in');
  else pinSubmit.classList.remove('fade-in');
});

// PIN submit
pinForm.addEventListener('submit', e=>{
  e.preventDefault();
  if(locked) return;
  if(pinInput.value===correctPINMain){
    localStorage.setItem('PINSuccess','true');
    localStorage.setItem('lastUser','main');
    pinContainer.innerHTML='<div class="spinner"></div>';
    const spinner=pinContainer.querySelector('.spinner');
    setTimeout(()=>spinner.classList.add('fade-in'),50);
    setTimeout(()=>{ showBlur(); setTimeout(()=>{window.location.href='kiosk.html';},2000); },10000);
  } else {
    pinInput.value='';
    pinInput.classList.remove('filled');
    pinSubmit.classList.remove('fade-in');
    pinError.classList.remove('hidden');
    locked=true;
    pinInput.disabled=true;
    setTimeout(()=>{
      pinError.classList.add('hidden');
      locked=false;
      pinInput.disabled=false;
      pinInput.focus();
    },15000);
  }
});

// Battery logic
async function initBattery() {
  const batteryBox = document.getElementById('batteryBox');
  const batteryFill = document.getElementById('batteryFill');
  const batteryBolt = document.getElementById('batteryBolt');
  const batteryPercent = document.getElementById('batteryPercent');

  if (!navigator.getBattery) {
    batteryBox.title = "Battery info unavailable";
    return;
  }

  const battery = await navigator.getBattery();

  function render() {
    const percent = Math.round(battery.level * 100);
    batteryFill.style.width = percent + '%';
    batteryBolt.style.display = battery.charging ? 'block' : 'none';
    batteryBox.title = `Battery: ${percent}% ${battery.charging ? '(Charging)' : ''}`;
    batteryPercent.textContent = percent + '%';
  }

  render();
  battery.addEventListener('levelchange', render);
  battery.addEventListener('chargingchange', render);
}
initBattery();
</script>
</body>
</html>
